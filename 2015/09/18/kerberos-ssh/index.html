
 <!DOCTYPE HTML>
<html lang="zh_CN">
<head>
  <meta charset="UTF-8">
  
    <title>SSH 使用 Kerberos 认证 | 飛哥の技术博客</title>
    <meta name="viewport" content="width=device-width, initial-scale=1,user-scalable=no">
    
    <meta name="author" content="李飛">
    

    
    <meta name="description" content="背景


Kerberos 是一款第三方认证软件，提供专属的 Kerberos 认证协议。在集群环境下，对统一的认证管理非常有帮助。我们常见的 SSH 认证方式有用户名密码认证，公钥私钥认证等，这些认证比较适合个人使用，但如果管辖的机器过多，就会出现调整认证的不方便。譬如：有 100 台服务器，由于业务需要，这些机器需要做到对特定账号免登，如果使用公钥私钥的方式，需要在每台机器中都要放置一个公钥和">
<meta property="og:type" content="article">
<meta property="og:title" content="SSH 使用 Kerberos 认证">
<meta property="og:url" content="http://lifei.github.io/2015/09/18/kerberos-ssh/index.html">
<meta property="og:site_name" content="飛哥の技术博客">
<meta property="og:description" content="背景


Kerberos 是一款第三方认证软件，提供专属的 Kerberos 认证协议。在集群环境下，对统一的认证管理非常有帮助。我们常见的 SSH 认证方式有用户名密码认证，公钥私钥认证等，这些认证比较适合个人使用，但如果管辖的机器过多，就会出现调整认证的不方便。譬如：有 100 台服务器，由于业务需要，这些机器需要做到对特定账号免登，如果使用公钥私钥的方式，需要在每台机器中都要放置一个公钥和">
<meta property="og:image" content="http://www.plantuml.com/plantuml/svg/NSen3iCW30NGdLDOxBb0LLK2Ce5w222MWbHC5Shz2yGJqxVV_rGE1Dlo5tm5AsYy3g-0Lwc3t4toxUEP2479eMfHFLKlQgQQHVUfkn0Mjkq52XxWgQRmGHRDQJZxLDr5dyQISwCK_IyLOZUSS_ZiX_i3">
<meta property="og:updated_time" content="2016-01-21T17:29:31.974Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="SSH 使用 Kerberos 认证">
<meta name="twitter:description" content="背景


Kerberos 是一款第三方认证软件，提供专属的 Kerberos 认证协议。在集群环境下，对统一的认证管理非常有帮助。我们常见的 SSH 认证方式有用户名密码认证，公钥私钥认证等，这些认证比较适合个人使用，但如果管辖的机器过多，就会出现调整认证的不方便。譬如：有 100 台服务器，由于业务需要，这些机器需要做到对特定账号免登，如果使用公钥私钥的方式，需要在每台机器中都要放置一个公钥和">

    
    <link rel="alternative" href="/atom.xml" title="飛哥の技术博客" type="application/atom+xml">
    
    
    <link rel="icon" href="/img/favicon.ico">
    
    
    <link rel="apple-touch-icon" href="/img/jacman.jpg">
    <link rel="apple-touch-icon-precomposed" href="/img/jacman.jpg">
    
    <link rel="stylesheet" href="/css/style.css" type="text/css">
</head>

  <body>
    <header>
      
<div>
		
			<div id="imglogo">
				<a href="/"><img src="/img/logo.jpg" alt="飛哥の技术博客" title="飛哥の技术博客"/></a>
			</div>
			
			<div id="textlogo">
				<h1 class="site-name"><a href="/" title="飛哥の技术博客">飛哥の技术博客</a></h1>
				<h2 class="blog-motto">关注业务开发</h2>
			</div>
			<div class="navbar"><a class="navbutton navmobile" href="#" title="菜單">
			</a></div>
			<nav class="animated">
				<ul>
					<ul>
					 
						<li><a href="/">首页</a></li>
					
						<li><a href="/archives">归档</a></li>
					
						<li><a href="/about">关于</a></li>
					
					<li>
 					
					<form class="search" action="//google.com/search" method="get" accept-charset="utf-8">
						<label>Search</label>
						<input type="search" id="search" name="q" autocomplete="off" maxlength="20" placeholder="搜索" />
						<input type="hidden" name="q" value="site:lifei.github.io">
					</form>
					
					</li>
				</ul>
			</nav>			
</div>
    </header>
    <div id="container">
      <div id="main" class="post" itemscope itemprop="blogPost">
  
	<article itemprop="articleBody"> 
		<header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2015/09/18/kerberos-ssh/" title="SSH 使用 Kerberos 认证" itemprop="url">SSH 使用 Kerberos 认证</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="李飛" target="_blank" itemprop="author">李飛</a>
		
  <p class="article-time">
    <time datetime="2015-09-18T06:32:00.000Z" itemprop="datePublished"> 發表於 2015-09-18</time>
    
  </p>
</header>
	<div class="article-content">
		
		<div id="toc" class="toc-article">
			<strong class="toc-title">文章目錄</strong>
		
			<ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#__"><span class="toc-number">1.</span> <span class="toc-text">背景</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#___2"><span class="toc-number">2.</span> <span class="toc-text">目标</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#___3"><span class="toc-number">3.</span> <span class="toc-text">方案架构</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#_sshd"><span class="toc-number">4.</span> <span class="toc-text">SSHD配置</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#_ssh_server_client_kerberos"><span class="toc-number">5.</span> <span class="toc-text">ssh server/client上Kerberos配置</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#_krb5_conf"><span class="toc-number">5.1.</span> <span class="toc-text">krb5.conf</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#__principal"><span class="toc-number">5.2.</span> <span class="toc-text">添加principal</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#__principal_key"><span class="toc-number">5.3.</span> <span class="toc-text">导出principal key</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#__k5login"><span class="toc-number">5.4.</span> <span class="toc-text">在服务端配置.k5login文件</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#_kerberos"><span class="toc-number">6.</span> <span class="toc-text">Kerberos服务器配置调整</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#_trouble_shooting"><span class="toc-number">7.</span> <span class="toc-text">Trouble shooting</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#__kdc_has_no_support_for_encryption_type"><span class="toc-number">7.1.</span> <span class="toc-text">“KDC has no support for encryption type”</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#__wrong_principal_in_request_debug1_got_no_client_credentials"><span class="toc-number">7.2.</span> <span class="toc-text">“Wrong principal in request/debug1: Got no client credentials”</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#__no_key_table_entry_found_matching_xxxxxx"><span class="toc-number">7.3.</span> <span class="toc-text">“No key table entry found matching xxxxxx”</span></a></li></ol></li></ol>
		
		</div>
		
		<div class="sect1">
<h2 id="__">背景</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Kerberos 是一款第三方认证软件，提供专属的 Kerberos 认证协议。在集群环境下，对统一的认证管理非常有帮助。我们常见的 SSH 认证方式有用户名密码认证，公钥私钥认证等，这些认证比较适合个人使用，但如果管辖的机器过多，就会出现调整认证的不方便。譬如：有 100 台服务器，由于业务需要，这些机器需要做到对特定账号免登，如果使用公钥私钥的方式，需要在每台机器中都要放置一个公钥和私钥，如果有一天私钥泄漏了，想要将这 100 台机器的认证私钥都调整一遍，真不是一件容易的事情。而对于集中认证的 Kerberos 来说，却是非常容易，只需要在 Kerberos 服务端重置一下 KEY 即可。</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="___2">目标</h2>
<div class="sectionbody">
<div class="olist arabic">
<ol class="arabic">
<li>
<p>实现各个服务器之间的免登；</p>
</li>
<li>
<p>认证泄漏后，调整成本最小；</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect1">
<h2 id="___3">方案架构</h2>
<div class="sectionbody">
<div class="paragraph">
<p>根据实际情况和安全需要，本方案设计双层认证的机制：</p>
</div>
<div class="olist arabic">
<div class="title">双层认证方案</div>
<ol class="arabic">
<li>
<p>开设 ansible 账号，为每台机器设置 ansible 账号的认证权限；</p>
</li>
<li>
<p>ansible 的认证仅在跳板机上进行；</p>
</li>
<li>
<p>开设 communication 账号，为每台机器设置 communication 账号的认证权限；</p>
</li>
<li>
<p>communication 的认证会在每一台服务器上进行，由 ansible 进行。</p>
</li>
</ol>
</div>
<div class="olist arabic">
<div class="title">安全措施</div>
<ol class="arabic">
<li>
<p>如果 ansible 认证泄漏，仅需要在 Kerberos 服务器上重置 ansible 账号的 KEY，在跳板机重新对 ansible 账号进行认证即可。</p>
</li>
<li>
<p>如果 communication 认证泄漏，需在 Kerberos 服务器上重置 communication 账号的 KEY，同时通过 ansible 账号对每台机器的 communication 账号进行认证。</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="title">架构图</div>
<div class="content">
<pre><img src="http://www.plantuml.com/plantuml/svg/NSen3iCW30NGdLDOxBb0LLK2Ce5w222MWbHC5Shz2yGJqxVV_rGE1Dlo5tm5AsYy3g-0Lwc3t4toxUEP2479eMfHFLKlQgQQHVUfkn0Mjkq52XxWgQRmGHRDQJZxLDr5dyQISwCK_IyLOZUSS_ZiX_i3"></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_sshd">SSHD配置</h2>
<div class="sectionbody">
<div class="listingblock">
<div class="title">sshd_config</div>
<div class="content">
<pre>ChallengeResponseAuthentication no

KerberosAuthentication no
KerberosOrLocalPasswd no
KerberosTicketCleanup no

GSSAPIAuthentication yes
GSSAPICleanupCredentials yes
GSSAPIStrictAcceptorCheck no
GSSAPIKeyExchange no

UsePAM yes</pre>
</div>
</div>
<div class="listingblock">
<div class="title">整体参考</div>
<div class="content">
<pre>Protocol 2
SyslogFacility AUTHPRIV
LogLevel INFO
PermitRoot no
PasswordAuthentication yes
ChallengeResponseAuthentication no
GSSAPIAuthentication yes
GSSAPICleanupCredentials yes
UsePAM yes
AcceptEnv LANG LC_CTYPE LC_NUMERIC LC_TIME LC_COLLATE LC_MONETARY LC_MESSAGES
AcceptEnv LC_PAPER LC_NAME LC_ADDRESS LC_TELEPHONE LC_MEASUREMENT
AcceptEnv LC_IDENTIFICATION LC_ALL LANGUAGE
AcceptEnv XMODIFIERS
X11Forwarding yes
Subsystem       sftp    /usr/libexec/openssh/sftp-server</pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_ssh_server_client_kerberos">ssh server/client上Kerberos配置</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_krb5_conf">krb5.conf</h3>
<div class="listingblock">
<div class="title">krb5.conf</div>
<div class="content">
<pre>[logging]
 default = FILE:/var/log/krb5libs.log

[libdefaults]
 default_realm = 7V1.NET
 dns_lookup_realm = false
 dns_lookup_kdc = false
 ticket_lifetime = 24h
 renew_lifetime = 7d
 forwardable = true

[realms]
 7V1.NET = &#123;
  kdc = 172.17.0.35
  admin_server = 172.17.0.35
  default_domain = 7v1.net
 &#125;

[domain_realm]
 .7v1.net = 7V1.NET
 7v1.net = 7V1.NET</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
这里使用7v1.net作为例子。
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="__principal">添加principal</h3>
<div class="paragraph">
<p>在<code>Kerberos</code>中注册本机</p>
</div>
<div class="listingblock">
<div class="title">server</div>
<div class="content">
<pre>kadmin -q "ank -randkey host/ssh.7v1.net"</pre>
</div>
</div>
<div class="listingblock">
<div class="title">client</div>
<div class="content">
<pre>kadmin -q "ank -randkey host/client.7v1.net"</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="__principal_key">导出principal key</h3>
<div class="paragraph">
<p>把本机的key的添加到keytab中</p>
</div>
<div class="listingblock">
<div class="title">server</div>
<div class="content">
<pre>kadmin -q "ktadd host/ssh.7v1.net"</pre>
</div>
</div>
<div class="listingblock">
<div class="title">client</div>
<div class="content">
<pre>kadmin -q "ank -randkey host/client.7v1.net"</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="__k5login">在服务端配置.k5login文件</h3>
<div class="listingblock">
<div class="title">.k5login</div>
<div class="content">
<pre>username@7V1.NET</pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_kerberos">Kerberos服务器配置调整</h2>
<div class="sectionbody">
<div class="paragraph">
<p>由于<code>Kerberos</code>版本升级兼容问题<sup class="footnote" id="_footnote_note2">[<a id="_footnoteref_1" class="footnote" href="#_footnote_1" title="View footnote.">1</a>]</sup>，
krb5 1.7及以后版本禁用了<code>DES encryption key</code>，会导致错误
<code>credential verification failed: KDC has no support for encryption type</code>，
请参考下面解决</p>
</div>
<div class="literalblock">
<div class="content">
<pre>This most commonly happens when trying to use a principal with only DES keys, in a release (MIT krb5 1.7 or later) which disables DES by default. DES encryption is considered weak due to its inadequate key size. If you cannot migrate away from its use, you can re-enable DES by adding allow_weak_crypto = true to the [libdefaults] section of krb5.conf.</pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_trouble_shooting">Trouble shooting</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="__kdc_has_no_support_for_encryption_type">“KDC has no support for encryption type”</h3>
<div class="paragraph">
<p>krb5 1.7及以后版本禁用了<code>DES encryption key</code>所致。</p>
</div>
</div>
<div class="sect2">
<h3 id="__wrong_principal_in_request_debug1_got_no_client_credentials">“Wrong principal in request/debug1: Got no client credentials”</h3>
<div class="paragraph">
<p>服务器没有配置 .k5login</p>
</div>
</div>
<div class="sect2">
<h3 id="__no_key_table_entry_found_matching_xxxxxx">“No key table entry found matching xxxxxx”</h3>
<div class="paragraph">
<p>服务端没有把导出key到keytab</p>
</div>
</div>
</div>
</div>
<div id="footnotes">
<hr>
<div class="footnote" id="_footnote_1">
<a href="#_footnoteref_1">1</a>. http://web.mit.edu/kerberos/krb5-devel/doc/admin/troubleshoot.html
</div>
</div>  
	</div>
		<footer class="article-footer clearfix">
<div class="article-catetags">


  <div class="article-tags">
  
  <span></span> <a href="/tags/Kerberos/">Kerberos</a><a href="/tags/SSH/">SSH</a><a href="/tags/运维/">运维</a>
  </div>

</div>



	<div class="article-share" id="share">
	
	  <div data-url="http://lifei.github.io/2015/09/18/kerberos-ssh/" data-title="SSH 使用 Kerberos 认证 | 飛哥の技术博客" data-tsina="null" class="share clearfix">
	  </div>
	
	</div>


</footer>

   	       
	</article>
	
<nav class="article-nav clearfix">
 
 <div class="prev" >
 <a href="/2015/10/03/openvpn-server/" title="搭建 OpenVPN 服务器">
  <strong>上一篇：</strong><br/>
  <span>
  搭建 OpenVPN 服务器</span>
</a>
</div>


<div class="next">
<a href="/2015/08/27/programming-proverbs/"  title="每个程序员都应该熟知的编程格言">
 <strong>下一篇：</strong><br/> 
 <span>每个程序员都应该熟知的编程格言
</span>
</a>
</div>

</nav>

	
<section id="comments" class="comment">
	<div class="ds-thread" data-thread-key="2015/09/18/kerberos-ssh/" data-title="SSH 使用 Kerberos 认证" data-url="http://lifei.github.io/2015/09/18/kerberos-ssh/"></div>
</section>


</div>  
      <div class="openaside"><a class="navbutton" href="#" title="顯示側邊欄"></a></div>

  <div id="toc" class="toc-aside">
  <strong class="toc-title">文章目錄</strong>
 
 <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#__"><span class="toc-number">1.</span> <span class="toc-text">背景</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#___2"><span class="toc-number">2.</span> <span class="toc-text">目标</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#___3"><span class="toc-number">3.</span> <span class="toc-text">方案架构</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#_sshd"><span class="toc-number">4.</span> <span class="toc-text">SSHD配置</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#_ssh_server_client_kerberos"><span class="toc-number">5.</span> <span class="toc-text">ssh server/client上Kerberos配置</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#_krb5_conf"><span class="toc-number">5.1.</span> <span class="toc-text">krb5.conf</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#__principal"><span class="toc-number">5.2.</span> <span class="toc-text">添加principal</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#__principal_key"><span class="toc-number">5.3.</span> <span class="toc-text">导出principal key</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#__k5login"><span class="toc-number">5.4.</span> <span class="toc-text">在服务端配置.k5login文件</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#_kerberos"><span class="toc-number">6.</span> <span class="toc-text">Kerberos服务器配置调整</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#_trouble_shooting"><span class="toc-number">7.</span> <span class="toc-text">Trouble shooting</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#__kdc_has_no_support_for_encryption_type"><span class="toc-number">7.1.</span> <span class="toc-text">“KDC has no support for encryption type”</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#__wrong_principal_in_request_debug1_got_no_client_credentials"><span class="toc-number">7.2.</span> <span class="toc-text">“Wrong principal in request/debug1: Got no client credentials”</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#__no_key_table_entry_found_matching_xxxxxx"><span class="toc-number">7.3.</span> <span class="toc-text">“No key table entry found matching xxxxxx”</span></a></li></ol></li></ol>
 
  </div>

<div id="asidepart">
<div class="closeaside"><a class="closebutton" href="#" title="隱藏側邊欄"></a></div>
<aside class="clearfix">

  
<div class="categorieslist">
	<p class="asidetitle">分類</p>
		<ul>
		
		  
		
		  
		
		</ul>
</div>


  
<div class="tagslist">
	<p class="asidetitle">標簽</p>
		<ul class="clearfix">
		
			
				<li><a href="/tags/SSH/" title="SSH">SSH<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/wsgi/" title="wsgi">wsgi<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/领域实体/" title="领域实体">领域实体<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/API/" title="API">API<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/http/" title="http">http<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/Kerberos/" title="Kerberos">Kerberos<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/thrift/" title="thrift">thrift<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/运维/" title="运维">运维<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/Webpack/" title="Webpack">Webpack<sup>1</sup></a></li>
			
		
			
		
			
		
			
		
		</ul>
</div>


  
  <div class="archiveslist">
    <p class="asidetitle"><a href="/archives">歸檔</a></p>
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/12/">十二月 2015</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/11/">十一月 2015</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/10/">十月 2015</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/09/">九月 2015</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/08/">八月 2015</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/07/">七月 2015</a><span class="archive-list-count">3</span></li></ul>
  </div>


  
  <div class="tagcloudlist">
    <p class="asidetitle">標簽雲</p>
    <div class="tagcloudlist clearfix">
       <a href="/tags/API/" style="font-size: 10px;">API</a> <a href="/tags/Kerberos/" style="font-size: 10px;">Kerberos</a> <a href="/tags/SSH/" style="font-size: 10px;">SSH</a> <a href="/tags/Webpack/" style="font-size: 10px;">Webpack</a> <a href="/tags/http/" style="font-size: 10px;">http</a> <a href="/tags/thrift/" style="font-size: 10px;">thrift</a> <a href="/tags/wsgi/" style="font-size: 10px;">wsgi</a> <a href="/tags/运维/" style="font-size: 10px;">运维</a> <a href="/tags/领域实体/" style="font-size: 10px;">领域实体</a>
    </div>
  </div>


  <div class="rsspart">
	<a href="/atom.xml" target="_blank" title="rss">RSS 訂閱</a>
</div>

</aside>
</div>
    </div>
    <footer><div id="footer" >
	
	<div class="line">
		<span></span>
		<div class="author"></div>
	</div>
	
	
	<section class="info">
		<p> 大家好，我是李飛。 <br/>
			这是我的博客。</p>
	</section>
	 
	<div class="social-font" class="clearfix">
		
		
		<a href="https://github.com/https://github.com/lifei" target="_blank" class="icon-github" title="github"></a>
		
		
		
		
		
		
		
		
		
		<a href="mailto:lifei.vip@outlook.com" target="_blank" class="icon-email" title="Email Me"></a>
		
	</div>
			
		
				<div class="cc-license">
          <a href="http://creativecommons.org/licenses/by-nc-nd/4.0" class="cc-opacity" target="_blank">
            <img src="/img/cc-by-nc-nd.svg" alt="Creative Commons" />
          </a>
        </div>
    

		<p class="copyright">
		Powered by <a href="http://hexo.io" target="_blank" title="hexo">hexo</a> and Theme by <a href="https://github.com/wuchong/jacman" target="_blank" title="Jacman">Jacman</a> © 2016 
		
		<a href="/about" target="_blank" title="李飛">李飛</a>
		
		
		</p>
</div>
</footer>
    <script src="/js/jquery-2.0.3.min.js"></script>
<script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>
<script src="/js/jquery.qrcode-0.12.0.min.js"></script>

<script type="text/javascript">
$(document).ready(function(){ 
  $('.navbar').click(function(){
    $('header nav').toggleClass('shownav');
  });
  var myWidth = 0;
  function getSize(){
    if( typeof( window.innerWidth ) == 'number' ) {
      myWidth = window.innerWidth;
    } else if( document.documentElement && document.documentElement.clientWidth) {
      myWidth = document.documentElement.clientWidth;
    };
  };
  var m = $('#main'),
      a = $('#asidepart'),
      c = $('.closeaside'),
      o = $('.openaside');
  c.click(function(){
    a.addClass('fadeOut').css('display', 'none');
    o.css('display', 'block').addClass('fadeIn');
    m.addClass('moveMain');
  });
  o.click(function(){
    o.css('display', 'none').removeClass('beforeFadeIn');
    a.css('display', 'block').removeClass('fadeOut').addClass('fadeIn');      
    m.removeClass('moveMain');
  });
  $(window).scroll(function(){
    o.css("top",Math.max(80,260-$(this).scrollTop()));
  });
  
  $(window).resize(function(){
    getSize(); 
    if (myWidth >= 1024) {
      $('header nav').removeClass('shownav');
    }else{
      m.removeClass('moveMain');
      a.css('display', 'block').removeClass('fadeOut');
      o.css('display', 'none');
      
      $('#toc.toc-aside').css('display', 'none');
        
    }
  });
});
</script>

<script type="text/javascript">
$(document).ready(function(){ 
  var ai = $('.article-content>iframe'),
      ae = $('.article-content>embed'),
      t  = $('#toc'),
      ta = $('#toc.toc-aside'),
      o  = $('.openaside'),
      c  = $('.closeaside');
  if(ai.length>0){
    ai.wrap('<div class="video-container" />');
  };
  if(ae.length>0){
   ae.wrap('<div class="video-container" />');
  };
  c.click(function(){
    ta.css('display', 'block').addClass('fadeIn');
  });
  o.click(function(){
    ta.css('display', 'none');
  });
  $(window).scroll(function(){
    ta.css("top",Math.max(140,320-$(this).scrollTop()));
  });
});
</script>


<script type="text/javascript">
$(document).ready(function(){ 
  var $this = $('.share'),
      url = $this.attr('data-url'),
      encodedUrl = encodeURIComponent(url),
      title = $this.attr('data-title'),
      tsina = $this.attr('data-tsina'),
      description = $this.attr('description');
  var html = [
  '<div class="hoverqrcode clearfix"></div>',
  '<a class="overlay" id="qrcode"></a>',
  '<a href="https://www.facebook.com/sharer.php?u=' + encodedUrl + '" class="article-share-facebook" target="_blank" title="Facebook"></a>',
  '<a href="https://twitter.com/intent/tweet?url=' + encodedUrl + '" class="article-share-twitter" target="_blank" title="Twitter"></a>',
  '<a href="#qrcode" class="article-share-qrcode" title="微信"></a>',
  '<a href="http://widget.renren.com/dialog/share?resourceUrl=' + encodedUrl + '&srcUrl=' + encodedUrl + '&title=' + title +'" class="article-share-renren" target="_blank" title="人人"></a>',
  '<a href="http://service.weibo.com/share/share.php?title='+title+'&url='+encodedUrl +'&ralateUid='+ tsina +'&searchPic=true&style=number' +'" class="article-share-weibo" target="_blank" title="微博"></a>',
  '<span title="Share to"></span>'
  ].join('');
  $this.append(html);

  $('.hoverqrcode').hide();

  var myWidth = 0;
  function updatehoverqrcode(){
    if( typeof( window.innerWidth ) == 'number' ) {
      myWidth = window.innerWidth;
    } else if( document.documentElement && document.documentElement.clientWidth) {
      myWidth = document.documentElement.clientWidth;
    };
    var qrsize = myWidth > 1024 ? 200:100;
    var options = {render: 'image', size: qrsize, fill: '#2ca6cb', text: url, radius: 0.5, quiet: 1};
    var p = $('.article-share-qrcode').position();
    $('.hoverqrcode').empty().css('width', qrsize).css('height', qrsize)
                          .css('left', p.left-qrsize/2+20).css('top', p.top-qrsize-10)
                          .qrcode(options);
  };
  $(window).resize(function(){
    $('.hoverqrcode').hide();
  });
  $('.article-share-qrcode').click(function(){
    updatehoverqrcode();
    $('.hoverqrcode').toggle();
  });
  $('.article-share-qrcode').hover(function(){}, function(){
      $('.hoverqrcode').hide();
  });
});   
</script>



<script type="text/javascript">
  var duoshuoQuery = {short_name:"lifei"};
  (function() {
    var ds = document.createElement('script');
    ds.type = 'text/javascript';ds.async = true;
    ds.src = '//static.duoshuo.com/embed.js';
    ds.charset = 'UTF-8';
    (document.getElementsByTagName('head')[0] 
    || document.getElementsByTagName('body')[0]).appendChild(ds);
  })();
</script> 







<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
$(document).ready(function(){ 
  $('.article-content').each(function(i){
    $(this).find('img').each(function(){
      if ($(this).parent().hasClass('fancybox')) return;
      var alt = this.alt;
      if (alt) $(this).after('<span class="caption">' + alt + '</span>');
      $(this).wrap('<a href="' + this.src + '" title="' + alt + '" class="fancybox"></a>');
    });
    $(this).find('.fancybox').each(function(){
      $(this).attr('rel', 'article' + i);
    });
  });
  if($.fancybox){
    $('.fancybox').fancybox();
  }
}); 
</script>



<!-- Analytics Begin -->





<!-- Analytics End -->

<!-- Totop Begin -->

	<div id="totop">
	<a title="返回頂部"><img src="/img/scrollup.png"/></a>
	</div>
	<script src="/js/totop.js"></script>

<!-- Totop End -->

<!-- MathJax Begin -->
<!-- mathjax config similar to math.stackexchange -->


<!-- MathJax End -->

<!-- Tiny_search Begin -->

<!-- Tiny_search End -->

  </body>
</html>
